# GC Forms API Documentation
(Version 1 - Pilot/trial - Limited to prototyping partners only)

## Welcome 

Welcome to the first iteration of the GC Forms application programming interface (API) and its technical documentation. This lite version of documentation is for developers who want to use the GC Forms API to retrieve form submission data programmatically into their department’s web application or back-office system. 

Our goal is to guide you through setting up an initial integration and securely retrieving form submissions, while also being able to learn from you in the process (for example: what’s challenging or what’s confusing) and then integrate your feedback into our upcoming iterations. We appreciate your patience as we continue to fill in the gaps and iron out issues along the way. Your open and honest feedback will help us improve GC Forms and shape the future of this product.

## Overview

The purpose of the GC Forms API is to allow you to securely and reliably retrieve form submissions directly from an API endpoint. Our hope is that this will eventually alleviate the level of effort associated with the retrieval of data and the tedious confirmation flows for high volumes of form submissions. So, rather than having to manually download and sign off on the removal of responses to confirm their retrieval from the database, the API will automate the workflow with systems that talk to each other and exchange data. 

This first version of the documentation includes what you need to know about:
- Getting started
- Authentication
- Making requests
- Monitoring
- Getting support

## Getting started

### What you will need
- A [GC Forms staging account](https://forms-staging.cdssandbox.xyz/) (used for temporary testing only)
- A form set to deliver responses via “Download” in Settings 
- A few “mock” responses submitted to the form
- A target system where you plan on receiving form submission data
- An API key (generated by you in Settings > API Access) 
- Infrastructure development resources who can craft HTTP requests and use Azure or AWS to reach the API

^ No infrastructure development capabilities available? 
^ This first version of the API might not be ready for you just yet. Consider choosing an alternative no-code delivery option to get responses by email or download them from GC Forms instead.

### Getting an API key

**To create an API key for this initial integration testing:**
1. Sign in to [GC Forms staging](https://forms-staging.cdssandbox.xyz/) (used for temporary testing only).
2. Create a draft form.
3. Go to “Settings” in the side navigation and then “API Access” in the tab menu.
4. Click “Generate Key”.
5. Download JSON file that includes the private API key.

^ **IMPORTANT!**
^ You must keep this API key secure as it is used to authenticate API requests and could be used to access protected data. Use encrypted email if you must share it with a developer team member to set up the integration.

## Authentication

### Base URL

**Now: _Staging_** currently available for prototyping purposes (temporarily)
```https://api.forms-staging.cdssandbox.xyz/```

**Later: _Production_** coming soon, not yet avialable for real live forms (eventually)
```[https://api.forms-staging.cdssandbox.xyz/](https://api.forms-formulaires.alpha.canada.ca/)```

### How authentication works

The GC Forms API leverages an OAuth 2.0 Signed JSON Web Token ([JWT](https://jwt.io/)) flow with a self-hosted Identity provider (IDP), Zitadel, to establish machine-to-machine authentication in a safe and secure way for the API endpoint. 

Authentication is done through an opaque token, with basic authorization handled via the user profile and the requested form ID. The OAuth server provides a short-lived access token that can be used to make API requests by verifying the client’s JWT that has been signed with a private key and includes their client ID. This access token is valid for 30 minutes. 

The API requires authentication with a Government of Canada email, an associated **formID**, a JWT signed with a **Private key** and verified using a **Public key** with the IDP. This token contains a claim to specify the form ID from which it is associated.

#### Integration examples

Once you’ve created a form, you can submit mock form submissions to simulate an active form and be able to test the integration. 

Use these examples as a reference to generate access tokens in your preferred programming language:
- [.NET / C#](https://github.com/cds-snc/forms-api/blob/main/examples/dotnet/AccessTokenGenerator.cs)
- [Node.JS / Typescript](https://github.com/cds-snc/forms-api/blob/main/examples/nodejs/accessTokenGenerator.ts)
- [Python](https://github.com/cds-snc/forms-api/blob/main/examples/python/access_token_generator.py)
- [Bash /Curl](https://github.com/cds-snc/forms-api/blob/main/examples/bash/get_access_token.sh)

#### Authorization header

Use this header for each API request to verify it’s you:

```
curl \
  --request GET "$FORMS_URL" \
  --header "Authorization: Bearer $ACCESS_TOKEN"
```

## Making requests

The GC Forms API allows you to retrieve form submissions as files in JSON file format. You can get up to 100 form submissions in a batch, and these are available for up to 30 days after submission, given our current data retention periods. Form submissions are encrypted with a public key and can be decrypted by you locally.

**Query parameters**
The API requests for GC Forms submission data are possible using query parameters such as:


- **{formID}**
  25-character alphanumeric string found at the end of the URL for the form or at the start of the 
  file name of the API key. 
  For example: ```clzvj8fzb00226o90r2b7l1gt```.


- **{SubmissionName}**
  11-character alphanumeric including dashes, sometimes also called the SubmissionID in the GC Forms 
  app. 
  For example: ```e02-08-d732```.


- **{ConfirmationCode}**
  36-character alphanumeric string that includes dashes, sometimes also called the Receipt code in the 
  GC Forms app. 
  For example: ```620b203c-9836-4000-bf30-1c3bcc26b834```.

**Examples**

We’ve developed some examples that you can reference or run the program for, that we hope will help make integration easier. Here are the programming languages currently available:

- [.NET / C#](https://github.com/cds-snc/forms-api/tree/main/examples/dotnet)
- [Node.JS / Typescript](https://github.com/cds-snc/forms-api/tree/main/examples/nodejs)
- [Python](https://github.com/cds-snc/forms-api/tree/main/examples/python)
- [Bash /Curl](https://github.com/cds-snc/forms-api/tree/main/examples/bash)

### Retrieving **new** form submissions

#### HTTP request

This URL path returns a list of submissions that includes the 100 oldest form submissions marked with a “New” status: 

```GET  /forms/{formID}/submission/new```

_Note: The status of these form submissions will not change to “Downloaded”._

#### Response status

| Status code | Example message | Meaning / how to fix |
| ----------- | --------------- | -------------------- |
| 200 | [
 ``` {
    "name": "05-09-09f4",
    "createdAt": 1725553403512
  },
  {
    "name": "05-09-9620",
    "createdAt": 1725553404965
  },
  {
    "name": "05-09-75dc",
    "createdAt": 1725553404972
  }
]
```
 | List of new submission names successfully retrieved. |

 
